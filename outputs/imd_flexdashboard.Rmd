---
title: "English indices of deprivation 2019"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library("flexdashboard")
library("readxl")
library("tidyverse")
library("sf")
library("leaflet")
library("DT")

imd_2019 = read_excel("../data/raw/File_1_-_IMD2019_Index_of_Multiple_Deprivation.xlsx", 
     sheet = "IMD2019")

# Keep only GM data
la_codes = c("E08000001", "E08000002", "E08000003", "E08000004", "E08000005",
               "E08000006", "E08000007", "E08000008", "E08000009", "E08000010")

imd_2019_gm =
  imd_2019 %>%
  filter(`Local Authority District code (2019)` %in% la_codes) 
```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r, echo = FALSE, message = FALSE, warning = FALSE}
geo = st_read("../data/raw/Lower_Layer_Super_Output_Areas_December_2011_Boundaries_EW_BSC/Lower_Layer_Super_Output_Areas_December_2011_Boundaries_EW_BSC.shp", quiet = TRUE)

# Keep only GM data
lsoa_codes = imd_2019_gm$`LSOA code (2011)`

geo_gm =
  geo %>%
  filter(LSOA11CD %in% lsoa_codes)

imd_geo = 
  left_join(geo_gm, imd_2019, by = c("LSOA11CD" = "LSOA code (2011)"))

pal = colorNumeric(palette = "Purples", domain = imd_geo$`Index of Multiple Deprivation (IMD) Decile`)

leaflet(imd_geo) %>%
  addTiles() %>%
  addPolygons(fillColor = ~pal(`Index of Multiple Deprivation (IMD) Decile`), 
              label = ~`LSOA name (2011)`, 
              weight = 2,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.8) %>%
      addLegend("bottomleft", pal = pal, values = ~`Index of Multiple Deprivation (IMD) Decile`,
    title = "IMD decile")
```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
imd_2019_gm %>%
  select(`LSOA name (2011)`, `Index of Multiple Deprivation (IMD) Rank`) %>%
  arrange(`Index of Multiple Deprivation (IMD) Rank`) %>%
  datatable()

```



