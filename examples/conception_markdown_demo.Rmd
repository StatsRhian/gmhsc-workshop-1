---
title: "Teenage Conceptions in Greater Manchester"
author: "Rhian Davies"
date: "17/02/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library("tidyverse")
df = read_csv(file = "../data/clean/conception_table6.csv")
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
df %>%
  filter(stat == "conceptions_per_100") %>%
  filter(Area != "ENGLAND") %>%
  mutate(is_total = (Area == "NORTH WEST")) %>%
  ggplot(aes(x = year, y = value)) + 
  geom_point(aes(col = is_total)) + 
  geom_line(aes(group = Area, col = is_total)) + 
  scale_color_manual(values = c("grey", "purple")) +
  theme(legend.position = "none") +
  ggtitle("Conceptions per 100 teenagers") 
```

```{r}
df %>%
  filter(stat == "conceptions_per_100") %>%
  filter(Area != "NORTH WEST") %>%
  filter(Area != "ENGLAND") %>%
  filter(year == 2017) %>%
  ggplot(aes(x =  reorder(Area, value), y = value)) + 
  geom_col() + 
  coord_flip() + 
  ggtitle("Teenage conceptions per 100 in the North West, split by Area") + 
  theme_minimal() + 
  ylab("") +
  xlab("")
```


```{r}
library("sf")
geo = st_read("../data/Local_Authority_Districts_December_2019_Boundaries_UK_BFC/Local_Authority_Districts_December_2019_Boundaries_UK_BFC.shp")

# Keep only GM data
lsoa_codes = c("E08000001", "E08000002", "E08000003", "E08000004", "E08000005",
               "E08000006", "E08000007", "E08000008", "E08000009", "E08000010",
               "E11000001", "E12000002", "E92000001")

geo_gm =
  geo %>%
  filter(lad19cd %in% lsoa_codes)
```

```{r}
teen_17 = 
  df %>%
  filter(year == 2017) %>%
  filter(stat == "conceptions_per_100")

teen_17_geo = 
  left_join(geo_gm, teen_17, by = c("lad19cd" = "LSOA"))
# Tmap
library("tmap")
tm_shape(teen_17_geo) +
  tm_polygons(col = "value", palette="Purples", title = "Teenager conceptions \n per 100") + 
  tm_text("Area", size = 0.7, col = "black")


```

# Leaflet map

```{r leafletmap}
library("leaflet")

pal = colorNumeric(palette = "Purples", domain = teen_17_geo$values)

teen_17_geo %>%
  st_transform(4326) %>%
  leaflet() %>%
  addTiles() %>%
  addPolygons(fillColor = ~pal(value),
              label = ~Area, 
              weight = 2,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.8,)


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
